<script>
 src ="https://maps.googleapis.com/maps/api/js?key=#{ENV['GOOGLE_API_BROWSER_KEY']}&callback=initMap"
</script>
  <% content_for(:after_js) do %>
    <%= javascript_tag do %>
      $(document).ready(function() {

        var directionsDisplay;
        var directionsService = new google.maps.DirectionsService();
        var map;
        var start = new google.maps.LatLng(<%= @journey.pick_up_location.latitude %>, <%= @journey.pick_up_location.longitude %>);
        var end = new google.maps.LatLng(<%= @journey.drop_off_location.latitude %>, <%= @journey.drop_off_location.longitude %>);

        function initialize() {
          directionsDisplay = new google.maps.DirectionsRenderer();
          var mapOptions = {
           zoom: 14,
           center: start
          }
          map = new google.maps.Map(document.getElementById('map'), mapOptions);
          directionsDisplay.setMap(map);
        }

        function calcRoute() {
          var request = {
            origin: start,
            destination: end,
            travelMode: 'DRIVING'
          };
          directionsService.route(request, function(response, status) {
            if (status == 'OK') {
             directionsDisplay.setDirections(response);
            }
          });
        }
      });
  <% end %>
 <% end %>

